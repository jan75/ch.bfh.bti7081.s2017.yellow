<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>Markdown Renderer</title>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/marked/0.3.6/marked.min.js"></script>
</head>
<body>
<div id="markdown-content" class="container">loading...</div>
</body>
<script type="text/javascript">
var renderPrefix = function(path) {
	if(path.slice(-3) === '.md') {
		return 'renderer.html#'
	} else {
		return ''
	}
};
var load = function() {
	var hash = window.location.hash.slice(1)
	var imageRootPath = hash.split('/').slice(0,-1).join('/')
	jQuery.get({
			url: hash
		}).then(function(data) {
			data = data.replace(/src *= *"([^\/][^"]*)"/g, function(a, g1) {
				return renderPrefix(g1)+'src="'+imageRootPath+'/'+g1+'"'
			})
			data = data.replace(/\[([^\]]+)\]\(([^\/][^)]*)\)/g, function(a,g1,g2) {
				return '['+g1+']('+renderPrefix(g2)+imageRootPath+'/'+g2+')"'
			})
			$('#markdown-content').html(marked(data));
			$("table").addClass("table table-striped table-hover");
		});
}

window.onhashchange = function() {
	load(location.hash)
}
load(location.hash)
</script>
</html>